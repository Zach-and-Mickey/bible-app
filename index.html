<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Bible App</title>
    <!-- Link to external CSS file or other head elements here -->
</head>
<body>
    <label for="version">Translation:</label>
    <select id="version" name="version">
        <option value="en-asv">American Standard Version</option>
        <option value="en-t4t">Translation for Translators</option>
        <option value="en-US-lxxup">Brenton English Septuagint</option>
        <option value="en-fbv">Free Bible Version (Thought for Thought)</option>
        <option value="en-bsb">Berean Study Bible</option>
        <option value="en-webus">World English Bible</option>
    </select>

    <label for="book">Book:</label>
    <select id="book" name="book">
        <option value="">Select Book</option>
    </select>

    <label for="chapter">Chapter:</label>
    <select id="chapter" name="chapter">
        <option value="">Select Chapter</option>
    </select>

    <h1>Book Chapter:Verse</h1>
    <div id="bibleText"></div>

    <script>
        // Wait for the DOM to fully load
        document.addEventListener('DOMContentLoaded', () => {
            // Function to fetch and load the Bible data from the JSON file
            function loadBibleData() {
                fetch('https://zach-and-mickey.github.io/bible-app/books.json')  // Path to your JSON file
                    .then(response => response.json())  // Parse the JSON response
                    .then(bibleData => {
                        // Call the function to populate dropdowns after the JSON is loaded
                        populateBookDropdown(bibleData);
                    })
                    .catch(error => {
                        console.error('Error loading Bible data:', error);
                    });
            }

            // Function to populate the Book dropdown
            function populateBookDropdown(bibleData) {
                const bookDropdown = document.getElementById('book');
                for (const book in bibleData) {
                    const option = document.createElement('option');
                    option.value = book;
                    option.textContent = book;
                    bookDropdown.appendChild(option);
                }

                // Add event listener to update chapter dropdown when a book is selected
                bookDropdown.addEventListener('change', function () {
                    const selectedBook = bookDropdown.value;
                    const chapterDropdown = document.getElementById('chapter');

                    // Clear previous chapter options
                    chapterDropdown.innerHTML = '<option value="">Select Chapter</option>';

                    if (selectedBook) {
                        // Get the number of chapters for the selected book
                        const numChapters = bibleData[selectedBook].chapters;

                        // Populate chapter dropdown with options from 1 to the number of chapters
                        for (let i = 1; i <= numChapters; i++) {
                            const option = document.createElement('option');
                            option.value = i;
                            option.textContent = `Chapter ${i}`;
                            chapterDropdown.appendChild(option);
                        }
                    }
                });

                // Add event listeners to update the Bible text when version, book, or chapter changes
                document.getElementById("version").addEventListener("change", updateBibleText);
                document.getElementById("book").addEventListener("change", updateBibleText);
                document.getElementById("chapter").addEventListener("change", updateBibleText);

                // Function to update Bible text
                function updateBibleText() {
                    const version = document.getElementById("version").value;
                    const book = document.getElementById("book").value;
                    const chapter = document.getElementById("chapter").value;

                    if (version && book && chapter) {
                        searchBible(version, book, chapter); // Call the search function
                    }
                }
            }

            // Load the Bible data on page load
            loadBibleData();
        });

function searchBible(version, book, chapter) {
    // Convert the book value to lowercase
    const lowerCaseBook = book.toLowerCase();
    
    // Construct URL using template literals with backticks
    const url = `https://cdn.jsdelivr.net/gh/wldeh/bible-api/bibles/${version}/books/${lowerCaseBook}/chapters/${chapter}.json`;

    console.log('Fetching URL:', url); // Log URL for debugging purposes

    fetch(url)
        .then(response => response.json())
        .then(data => {
            // Access the array from data.key
            const verses = data.data;

            // Loop through verses and find the specific chapter and verse
            const chapterText = verses
                .filter(verse => verse.chapter === chapter)  // Filter by the chapter
                .map(verse => {
                    // Check if the chapter matches and display the text
                    return `<p><strong>Verse ${verse.verse}: </strong>${verse.text}</p>`;
                }).join('');

            // If no verses are found, inform the user
            if (!chapterText) {
                chapterText = 'No text available for this chapter and verse.';
            }

            // Optionally, display the result on the webpage
            document.getElementById("bibleText").innerHTML = chapterText;
        })
        .catch(error => {
            console.error("Error fetching Bible text:", error);
            document.getElementById("bibleText").innerHTML = 'Error loading Bible text. Please try again later.';
        });
}

    </script>

    <footer>
        <p>Thanks to <a href="https://github.com/wldeh/bible-api" target="_blank">github.com/wldeh/bible-api</a> for making this possible!</p>
    </footer>
</body>
</html>
